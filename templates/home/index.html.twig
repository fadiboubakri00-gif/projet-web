{% extends 'base.html.twig' %}

{% block title %}Dashboard{% endblock %}

{% block body %}
<div class="container" style="padding-top:2rem;"> {# move a bit lower #}
    <h1 class="dashboard-title">ðŸŽµ Darbouka Admin Dashboard</h1>

    <div class="row justify-content-center g-4">
        <div class="col-md-4">
            <a href="{{ path('app_user_index') }}" class="text-decoration-none">
                <div class="card p-4 text-center">
                    <i class="bi bi-person-circle entity-icon"></i>
                    <h2 class="count" data-target="{{ userCount }}">0</h2>
                    <h5 class="card-title mt-3">Users</h5>
                </div>
            </a>
        </div>

        <div class="col-md-4">
            <a href="{{ path('app_product_index') }}" class="text-decoration-none">
                <div class="card p-4 text-center">
                    <i class="bi bi-box-seam entity-icon"></i>
                    <h2 class="count" data-target="{{ productCount }}">0</h2>
                    <h5 class="card-title mt-3">Products</h5>
                </div>
            </a>
        </div>

        <div class="col-md-4">
            <a href="{{ path('app_category_index') }}" class="text-decoration-none">
                <div class="card p-4 text-center">
                    <i class="bi bi-tags-fill entity-icon"></i>
                    <h2 class="count" data-target="{{ categoryCount }}">0</h2>
                    <h5 class="card-title mt-3">Categories</h5>
                </div>
            </a>
        </div>

        <div class="col-md-4">
            <a href="{{ path('app_cart_index') }}" class="text-decoration-none">
                <div class="card p-4 text-center">
                    <i class="bi bi-basket-fill entity-icon"></i>
                    <h2 class="count" data-target="{{ cartCount }}">0</h2>
                    <h5 class="card-title mt-3">Carts</h5>
                </div>
            </a>
        </div>

        <div class="col-md-4">
            <a href="{{ path('app_order_index') }}" class="text-decoration-none">
                <div class="card p-4 text-center">
                    <i class="bi bi-receipt entity-icon"></i>
                    <h2 class="count" data-target="{{ orderCount }}">0</h2>
                    <h5 class="card-title mt-3">Orders</h5>
                </div>
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const counters = document.querySelectorAll('.count');

    counters.forEach(counter => {
        const target = +counter.getAttribute('data-target');
        
        function animateCounter() {
            let iteration = 0;
            const maxIterations = 20; // number of random flashes
            const flashSpeed = 30; // ms between flashes

            const flashInterval = setInterval(() => {
                iteration++;
                if(iteration < maxIterations){
                    // flash random number for visual effect
                    counter.innerText = Math.floor(Math.random() * (target + 10));
                } else {
                    clearInterval(flashInterval);
                    // count smoothly to final number
                    let current = 0;
                    const smoothStep = () => {
                        if(current < target){
                            current += Math.ceil(Math.max(1, target / 15));
                            if(current > target) current = target;
                            counter.innerText = current;
                            requestAnimationFrame(smoothStep);
                        } else {
                            counter.innerText = target;
                        }
                    };
                    smoothStep();
                }
            }, flashSpeed);
        }

        counter.parentElement.addEventListener('mouseenter', animateCounter);
    });
});
</script>
{% endblock %}
